<?html
session_start();
if (!isset($_SESSION['admin']) || $_SESSION['admin'] !== true) {
  die("Accès refusé.");
}

$target = $_POST['target'] ?? '';
$action = $_POST['action'] ?? '';

if ($target === '' || $action === '') {
  die("Paramètres manquants.");
}

$conn = new mysqli('localhost', 'root', '', 'project_anima');
if ($conn->connect_error) die("Erreur DB.");

switch ($action) {
  case 'ban':
    $stmt = $conn->prepare("INSERT IGNORE INTO banned_users (pseudo) VALUES (?)");
    break;
  case 'mute':
    $stmt = $conn->prepare("INSERT IGNORE INTO muted_users (pseudo) VALUES (?)");
    break;
  case 'kick':
    $stmt = $conn->prepare("DELETE FROM active_users WHERE ip_address = (SELECT ip_address FROM patients WHERE pseudo = ?)");
    break;
  default:
    die("Action non reconnue.");
}

$stmt->bind_param("s", $target);
$stmt->execute();
$stmt->close();
$conn->close();

header("Location: fenetrechat.html");
exit;
?>
